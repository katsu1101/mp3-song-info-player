(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,38142,e=>{"use strict";var t=e.i(81995),a=e.i(93432),r=e.i(6568),i=e.i(1495),n=e.i(30222),s=e.i(19102);let d=(0,a.default)("music-metadata:id3v2:frame-parser"),o="latin1",l={encoding:o,bom:!1};function c(e){return"RX"===e?"Remix":"CR"===e?"Cover":e.match(/^\d*$/)?n.Genres[Number.parseInt(e,10)]:void 0}class h{constructor(e,t){this.major=e,this.warningCollector=t}readData(e,a,n){let s;if(0===e.length)return void this.warningCollector.addWarning(`id3v2.${this.major} header has empty tag type=${a}`);let{encoding:m,bom:g}=i.TextEncodingToken.get(e,0),k=e.length,T=0,p=[],f=h.getNullTerminatorLength(m);switch(d(`Parsing tag type=${a}, encoding=${m}, bom=${g}`),"TXXX"!==a&&"T"===a[0]?"T*":a){case"T*":case"GRP1":case"IPLS":case"MVIN":case"MVNM":case"PCS":case"PCST":{let t;try{t=h.trimNullPadding(r.decodeString(e.subarray(1),m))}catch(e){if(e instanceof Error){this.warningCollector.addWarning(`id3v2.${this.major} type=${a} header has invalid string value: ${e.message}`);break}throw e}switch(a){case"TMCL":case"TIPL":case"IPLS":p=h.functionList(this.splitValue(a,t));break;case"TRK":case"TRCK":case"TPOS":p=t;break;case"TCOM":case"TEXT":case"TOLY":case"TOPE":case"TPE1":case"TSRC":p=this.splitValue(a,t);break;case"TCO":case"TCON":p=this.splitValue(a,t).map(e=>(function(e){let t,a=[],r="";for(let i of e)if("string"==typeof t)if("("===i&&""===t)r+="(",t=void 0;else if(")"===i){""!==r&&(a.push(r),r="");let e=c(t);e&&a.push(e),t=void 0}else t+=i;else"("===i?t="":r+=i;return r&&(0===a.length&&r.match(/^\d*$/)&&(r=c(r)),r&&a.push(r)),a})(e)).reduce((e,t)=>e.concat(t),[]);break;case"PCS":case"PCST":p=Array.isArray(p=this.major>=4?this.splitValue(a,t):[t])&&""===p[0]?1:0;break;default:p=this.major>=4?this.splitValue(a,t):[t]}break}case"TXXX":{let t=h.readIdentifierAndData(e.subarray(1),m);p={description:t.id,text:this.splitValue(a,r.decodeString(t.data,m).replace(/\x00+$/,""))};break}case"PIC":case"APIC":if(n){let t={};switch(e=e.subarray(1),this.major){case 2:t.format=r.decodeString(e.subarray(0,3),"latin1"),e=e.subarray(3);break;case 3:case 4:s=r.findZero(e,o),t.format=r.decodeString(e.subarray(0,s),o),e=e.subarray(s+1);break;default:throw function(e){throw new u(`Unexpected majorVer: ${e}`)}(this.major)}t.format=h.fixPictureMimeType(t.format),t.type=i.AttachedPictureType[e[0]],e=e.subarray(1),s=r.findZero(e,m),t.description=r.decodeString(e.subarray(0,s),m),t.data=e=e.subarray(s+f),p=t}break;case"CNT":case"PCNT":p=(0,r.decodeUintBE)(e);break;case"SYLT":{let a=i.SyncTextHeader.get(e,0);e=e.subarray(i.SyncTextHeader.len);let r={descriptor:"",language:a.language,contentType:a.contentType,timeStampFormat:a.timeStampFormat,syncText:[]},n=!1;for(;e.length>0;){let i=h.readNullTerminatedString(e,a.encoding);if(e=e.subarray(i.len),n){let a=t.UINT32_BE.get(e,0);e=e.subarray(t.UINT32_BE.len),r.syncText.push({text:i.text,timestamp:a})}else r.descriptor=i.text,n=!0}p=r;break}case"ULT":case"USLT":case"COM":case"COMM":{let t=i.TextHeader.get(e,T);T+=i.TextHeader.len;let a=h.readNullTerminatedString(e.subarray(T),t.encoding);T+=a.len;let r=h.readNullTerminatedString(e.subarray(T),t.encoding);p={language:t.language,descriptor:a.text,text:r.text};break}case"UFID":{let t=h.readIdentifierAndData(e,o);p={owner_identifier:t.id,identifier:t.data};break}case"PRIV":{let t=h.readIdentifierAndData(e,o);p={owner_identifier:t.id,data:t.data};break}case"POPM":{e=e.subarray(T);let i=h.readNullTerminatedString(e,l),n=i.text;if(0===(e=e.subarray(i.len)).length){this.warningCollector.addWarning(`id3v2.${this.major} type=${a} POPM frame missing rating byte`),p={email:n,rating:0,counter:void 0};break}let s=t.UINT8.get(e,0),d=e.subarray(t.UINT8.len);p={email:n,rating:s,counter:d.length>0?(0,r.decodeUintBE)(d):void 0};break}case"GEOB":{let{encoding:t,bom:a}=i.TextEncodingToken.get(e,0);e=e.subarray(1);let r=h.readNullTerminatedString(e,l),n=r.text;e=e.subarray(r.len);let s=h.readNullTerminatedString(e,{encoding:t,bom:a}),d=s.text;e=e.subarray(s.len);let o=h.readNullTerminatedString(e,{encoding:t,bom:a});p={type:n,filename:d,description:o.text,data:e=e.subarray(o.len)};break}case"WCOM":case"WCOP":case"WOAF":case"WOAR":case"WOAS":case"WORS":case"WPAY":case"WPUB":p=h.readNullTerminatedString(e,l).text;break;case"WXXX":{let{encoding:t,bom:a}=i.TextEncodingToken.get(e,0);e=e.subarray(1);let n=h.readNullTerminatedString(e,{encoding:t,bom:a}),s=n.text;e=e.subarray(n.len),p={description:s,url:h.trimNullPadding(r.decodeString(e,o))};break}case"WFD":case"WFED":{let{encoding:t,bom:a}=i.TextEncodingToken.get(e,0);e=e.subarray(1),p=h.readNullTerminatedString(e,{encoding:t,bom:a}).text;break}case"MCDI":p=e.subarray(0,k);break;default:d(`Warning: unsupported id3v2-tag-type: ${a}`)}return p}static readNullTerminatedString(e,t){let a=2*!!t.bom,i=e.length,n=e.subarray(a),s=r.findZero(n,t.encoding);if(s>=n.length)return{text:r.decodeString(n,t.encoding),len:i};let d=n.subarray(0,s);return{text:r.decodeString(d,t.encoding),len:a+s+h.getNullTerminatorLength(t.encoding)}}static fixPictureMimeType(e){switch(e=e.toLocaleLowerCase()){case"jpg":return"image/jpeg";case"png":return"image/png"}return e}static functionList(e){let t={};for(let a=0;a+1<e.length;a+=2){let r=e[a+1].split(",");t[e[a]]=t[e[a]]?t[e[a]].concat(r):r}return t}splitValue(e,t){let a;return this.major<4?(a=t.split(/\x00/g)).length>1?this.warningCollector.addWarning(`ID3v2.${this.major} ${e} uses non standard null-separator.`):a=t.split(/\//g):a=t.split(/\x00/g),h.trimArray(a)}static trimArray(e){return e.map(e=>h.trimNullPadding(e).trim())}static trimNullPadding(e){let t=e.length;for(;t>0&&0===e.charCodeAt(t-1);)t--;return t===e.length?e:e.slice(0,t)}static readIdentifierAndData(e,t){let a=h.readNullTerminatedString(e,{encoding:t,bom:!1});return{id:a.text,data:e.subarray(a.len)}}static getNullTerminatorLength(e){return e.startsWith("utf-16")?2:1}}class u extends(0,s.makeUnexpectedFileContentError)("id3v2"){}var m=e.i(62950);function g(e){throw new u(`Unexpected majorVer: ${e}`)}class k{constructor(){this.tokenizer=void 0,this.id3Header=void 0,this.metadata=void 0,this.headerType=void 0,this.options=void 0}static removeUnsyncBytes(e){let t=0,a=0;for(;t<e.length-1;)t!==a&&(e[a]=e[t]),t+=255===e[t]&&0===e[t+1]?2:1,a++;return t<e.length&&(e[a++]=e[t]),e.subarray(0,a)}static readFrameData(e,t,a,r,i){let n=new h(a,i);switch(a){case 2:return n.readData(e,t.id,r);case 3:case 4:return t.flags?.format.unsynchronisation&&(e=k.removeUnsyncBytes(e)),t.flags?.format.data_length_indicator&&(e=e.subarray(4,e.length)),n.readData(e,t.id,r);default:throw function(e){throw new u(`Unexpected majorVer: ${e}`)}(a)}}static makeDescriptionTagName(e,t){return e+(t?`:${t}`:"")}async parse(e,t,a){this.tokenizer=t,this.metadata=e,this.options=a;let r=await this.tokenizer.readToken(i.ID3v2Header);if("ID3"!==r.fileIdentifier)throw new u("expected ID3-header file-identifier 'ID3' was not found");return this.id3Header=r,this.headerType=`ID3v2.${r.version.major}`,r.flags.isExtendedHeader?this.parseExtendedHeader():this.parseId3Data(r.size)}async parseExtendedHeader(){let e=await this.tokenizer.readToken(i.ExtendedHeader),t=e.size-i.ExtendedHeader.len;return t>0?this.parseExtendedHeaderData(t,e.size):this.parseId3Data(this.id3Header.size-e.size)}async parseExtendedHeaderData(e,t){return await this.tokenizer.ignore(e),this.parseId3Data(this.id3Header.size-t)}async parseId3Data(e){let a=await this.tokenizer.readToken(new t.Uint8ArrayType(e));for(let e of this.parseMetadata(a))"TXXX"===e.id?e.value&&await this.handleTag(e,e.value.text,()=>e.value.description):await (Array.isArray(e.value)?Promise.all(e.value.map(t=>this.addTag(e.id,t))):this.addTag(e.id,e.value))}async handleTag(e,t,a,r=e=>e){await Promise.all(t.map(t=>this.addTag(k.makeDescriptionTagName(e.id,a(t)),r(t))))}async addTag(e,t){await this.metadata.addTag(this.headerType,e,t)}parseMetadata(e){let a=0,n=[];for(;a!==e.length;){let s=function(e){switch(e){case 2:return 6;case 3:case 4:return 10;default:throw g(e)}}(this.id3Header.version.major);if(a+s>e.length){this.metadata.addWarning("Illegal ID3v2 tag length");break}let d=e.subarray(a,a+s);a+=s;let o=function(e,a,n){switch(a){case 2:return function(e,a,r){let i={id:(0,m.textDecode)(e.subarray(0,3),"ascii"),length:t.UINT24_BE.get(e,3)};return i.id.match(/^[A-Z0-9]{3}$/)||r.addWarning(`Invalid ID3v2.${a} frame-header-ID: ${i.id}`),i}(e,a,n);case 3:case 4:return function(e,a,n){var s;let d={id:(0,m.textDecode)(e.subarray(0,4),"ascii"),length:(4===a?i.UINT32SYNCSAFE:t.UINT32_BE).get(e,4),flags:(s=e.subarray(8,10),{status:{tag_alter_preservation:r.getBit(s,0,6),file_alter_preservation:r.getBit(s,0,5),read_only:r.getBit(s,0,4)},format:{grouping_identity:r.getBit(s,1,7),compression:r.getBit(s,1,3),encryption:r.getBit(s,1,2),unsynchronisation:r.getBit(s,1,1),data_length_indicator:r.getBit(s,1,0)}})};return d.id.match(/^[A-Z0-9]{4}$/)||n.addWarning(`Invalid ID3v2.${a} frame-header-ID: ${d.id}`),d}(e,a,n);default:throw g(a)}}(d,this.id3Header.version.major,this.metadata),l=e.subarray(a,a+o.length);a+=o.length;let c=k.readFrameData(l,o,this.id3Header.version.major,!this.options.skipCovers,this.metadata);c&&n.push({id:o.id,value:c})}return n}}e.s(["ID3v2Parser",()=>k],38142)},90321,e=>{"use strict";var t=e.i(81995),a=e.i(93432),r=e.i(50868),i=e.i(93403),n=e.i(20881),s=e.i(38142);let d={len:12,get:(e,a)=>({chunkID:i.FourCcToken.get(e,a),chunkSize:t.INT64_BE.get(e,a+4)})};var o=e.i(19102);let l=(0,a.default)("music-metadata:parser:aiff");class c extends(0,o.makeUnexpectedFileContentError)("DSDIFF"){}class h extends n.BasicParser{async parse(){let e=await this.tokenizer.readToken(d);if("FRM8"!==e.chunkID)throw new c("Unexpected chunk-ID");this.metadata.setAudioOnly();let t=(await this.tokenizer.readToken(i.FourCcToken)).trim();if("DSD"===t)return this.metadata.setFormat("container",`DSDIFF/${t}`),this.metadata.setFormat("lossless",!0),this.readFmt8Chunks(e.chunkSize-BigInt(i.FourCcToken.len));throw new c(`Unsupported DSDIFF type: ${t}`)}async readFmt8Chunks(e){for(;e>=d.len;){let t=await this.tokenizer.readToken(d);l(`Chunk id=${t.chunkID}`),await this.readData(t),e-=BigInt(d.len)+t.chunkSize}}async readData(e){l(`Reading data of chunk[ID=${e.chunkID}, size=${e.chunkSize}]`);let a=this.tokenizer.position;switch(e.chunkID.trim()){case"FVER":{let e=await this.tokenizer.readToken(t.UINT32_LE);l(`DSDIFF version=${e}`);break}case"PROP":if("SND "!==await this.tokenizer.readToken(i.FourCcToken))throw new c("Unexpected PROP-chunk ID");await this.handleSoundPropertyChunks(e.chunkSize-BigInt(i.FourCcToken.len));break;case"ID3":{let a=await this.tokenizer.readToken(new t.Uint8ArrayType(Number(e.chunkSize))),i=r.fromBuffer(a);await new s.ID3v2Parser().parse(this.metadata,i,this.options);break}case"DSD":this.metadata.format.numberOfChannels&&this.metadata.setFormat("numberOfSamples",Number(e.chunkSize*BigInt(8)/BigInt(this.metadata.format.numberOfChannels))),this.metadata.format.numberOfSamples&&this.metadata.format.sampleRate&&this.metadata.setFormat("duration",this.metadata.format.numberOfSamples/this.metadata.format.sampleRate);break;default:l(`Ignore chunk[ID=${e.chunkID}, size=${e.chunkSize}]`)}let n=e.chunkSize-BigInt(this.tokenizer.position-a);n>0&&(l(`After Parsing chunk, remaining ${n} bytes`),await this.tokenizer.ignore(Number(n)))}async handleSoundPropertyChunks(e){for(l(`Parsing sound-property-chunks, remainingSize=${e}`);e>0;){let a=await this.tokenizer.readToken(d);l(`Sound-property-chunk[ID=${a.chunkID}, size=${a.chunkSize}]`);let r=this.tokenizer.position;switch(a.chunkID.trim()){case"FS":{let e=await this.tokenizer.readToken(t.UINT32_BE);this.metadata.setFormat("sampleRate",e);break}case"CHNL":{let e=await this.tokenizer.readToken(t.UINT16_BE);this.metadata.setFormat("numberOfChannels",e),await this.handleChannelChunks(a.chunkSize-BigInt(t.UINT16_BE.len));break}case"CMPR":{let e=(await this.tokenizer.readToken(i.FourCcToken)).trim(),a=await this.tokenizer.readToken(t.UINT8),r=await this.tokenizer.readToken(new t.StringType(a,"ascii"));"DSD"===e&&(this.metadata.setFormat("lossless",!0),this.metadata.setFormat("bitsPerSample",1)),this.metadata.setFormat("codec",`${e} (${r})`);break}case"ABSS":{let e=await this.tokenizer.readToken(t.UINT16_BE),a=await this.tokenizer.readToken(t.UINT8),r=await this.tokenizer.readToken(t.UINT8),i=await this.tokenizer.readToken(t.UINT32_BE);l(`ABSS ${e}:${a}:${r}.${i}`);break}case"LSCO":{let e=await this.tokenizer.readToken(t.UINT16_BE);l(`LSCO lsConfig=${e}`);break}default:l(`Unknown sound-property-chunk[ID=${a.chunkID}, size=${a.chunkSize}]`),await this.tokenizer.ignore(Number(a.chunkSize))}let n=a.chunkSize-BigInt(this.tokenizer.position-r);n>0&&(l(`After Parsing sound-property-chunk ${a.chunkSize}, remaining ${n} bytes`),await this.tokenizer.ignore(Number(n))),e-=BigInt(d.len)+a.chunkSize,l(`Parsing sound-property-chunks, remainingSize=${e}`)}if(this.metadata.format.lossless&&this.metadata.format.sampleRate&&this.metadata.format.numberOfChannels&&this.metadata.format.bitsPerSample){let e=this.metadata.format.sampleRate*this.metadata.format.numberOfChannels*this.metadata.format.bitsPerSample;this.metadata.setFormat("bitrate",e)}}async handleChannelChunks(e){l(`Parsing channel-chunks, remainingSize=${e}`);let t=[];for(;e>=i.FourCcToken.len;){let a=await this.tokenizer.readToken(i.FourCcToken);l(`Channel[ID=${a}]`),t.push(a),e-=BigInt(i.FourCcToken.len)}return l(`Channels: ${t.join(", ")}`),t}}e.s(["DsdiffContentParseError",()=>c,"DsdiffParser",()=>h],90321)}]);